---
sidebar_position: 1
---

import ApiPlayground from '@site/src/components/ApiPlayground';

# Taxonom√≠a

M√≥dulo de gesti√≥n de taxonom√≠as (vocabularios y t√©rminos) para categorizaci√≥n de productos. Soporta navegaci√≥n jer√°rquica con √°rboles y breadcrumbs.

## Adaptadores Disponibles

Este m√≥dulo soporta **dos adaptadores intercambiables** que se seleccionan mediante headers HTTP:

### SQL
- **Header**: Sin header o cualquier valor que no sea `local`
- **Persistencia**: MySQL/PostgreSQL
- **Uso**: Producci√≥n, datos persistentes

### Local
- **Header**: `X-TAXONOMY-ADAPTER: local`
- **Persistencia**: Solo en memoria RAM con datos jer√°rquicos pre-cargados
- **Uso**: Testing, desarrollo, datos temporales

## Endpoints

> **Nota:** Los ejemplos usan el adapter local por defecto con datos de prueba. Para producci√≥n usa adapter SQL (sin header). Los IDs de prueba son: vocab-1 (Product Categories), vocab-2 (Brands), term-1 (Electronics), term-2 (Smartphones), etc.

### Crear Vocabulario

<ApiPlayground
  method="POST"
  endpoint="/v1/taxonomy/vocabularies/create"
  headers={{ "X-TAXONOMY-ADAPTER": "" }}
  body={{
    name: "Product Categories"
  }}
  description="Crea un nuevo vocabulario"
/>

### Listar Vocabularios

<ApiPlayground
  method="GET"
  endpoint="/v1/taxonomy/vocabularies/read"
  headers={{ "X-TAXONOMY-ADAPTER": "local" }}
  description="Obtiene todos los vocabularios. Con adapter local muestra vocab-1 (Product Categories) y vocab-2 (Brands)"
/>

### Obtener Vocabulario

<ApiPlayground
  method="GET"
  endpoint="/v1/taxonomy/vocabularies/show/{id}"
  params={{ id: "vocab-1" }}
  headers={{ "X-TAXONOMY-ADAPTER": "local" }}
  description="Obtiene un vocabulario por ID. Con adapter local: vocab-1 (Product Categories), vocab-2 (Brands)"
/>

### Actualizar Vocabulario

<ApiPlayground
  method="PUT"
  endpoint="/v1/taxonomy/vocabularies/update/{id}"
  params={{ id: "uuid-here" }}
  headers={{ "X-TAXONOMY-ADAPTER": "" }}
  body={{
    name: "Updated Categories"
  }}
  description="Actualiza un vocabulario existente"
/>

### Eliminar Vocabulario

<ApiPlayground
  method="DELETE"
  endpoint="/v1/taxonomy/vocabularies/delete/{id}"
  params={{ id: "uuid-here" }}
  headers={{ "X-TAXONOMY-ADAPTER": "" }}
  description="Elimina un vocabulario"
/>

### Crear T√©rmino

<ApiPlayground
  method="POST"
  endpoint="/v1/taxonomy/terms/create"
  headers={{ "X-TAXONOMY-ADAPTER": "" }}
  body={{
    name: "New Category",
    vocabulary_id: "vocab-1"
  }}
  description="Crea un nuevo t√©rmino dentro de un vocabulario"
/>

### Listar T√©rminos

<ApiPlayground
  method="GET"
  endpoint="/v1/taxonomy/terms/read"
  headers={{ "X-TAXONOMY-ADAPTER": "local" }}
  queryParams={{ vocabulary_id: "vocab-1" }}
  description="Lista todos los t√©rminos, opcionalmente filtrados por vocabulario. Con adapter local muestra datos de prueba jer√°rquicos."
/>

### Obtener T√©rmino

<ApiPlayground
  method="GET"
  endpoint="/v1/taxonomy/terms/show/{id}"
  params={{ id: "term-2" }}
  headers={{ "X-TAXONOMY-ADAPTER": "local" }}
  description="Obtiene un t√©rmino por ID. Con adapter local: term-1 (Electronics), term-2 (Smartphones), etc."
/>

### Actualizar T√©rmino

<ApiPlayground
  method="PUT"
  endpoint="/v1/taxonomy/terms/update/{id}"
  params={{ id: "uuid-here" }}
  headers={{ "X-TAXONOMY-ADAPTER": "" }}
  body={{
    name: "Updated Electronics",
    vocabulary_id: "uuid-here"
  }}
  description="Actualiza un t√©rmino existente"
/>

### Eliminar T√©rmino

<ApiPlayground
  method="DELETE"
  endpoint="/v1/taxonomy/terms/delete/{id}"
  params={{ id: "uuid-here" }}
  headers={{ "X-TAXONOMY-ADAPTER": "" }}
  description="Elimina un t√©rmino"
/>

### √Årbol de T√©rminos

<ApiPlayground
  method="GET"
  endpoint="/v1/taxonomy/terms/tree"
  queryParams={{
    vocabulary_id: "vocab-1",
    parent_id: ""
  }}
  headers={{ "X-TAXONOMY-ADAPTER": "local" }}
  description="Obtiene el √°rbol jer√°rquico de t√©rminos. Para adapter local, incluye datos pre-cargados con jerarqu√≠as Electronics ‚Üí Smartphones/Laptops y Clothing ‚Üí Men's ‚Üí Shirts/Pants"
/>

### Breadcrumb de T√©rmino

<ApiPlayground
  method="GET"
  endpoint="/v1/taxonomy/terms/breadcrumb/{id}"
  params={{ id: "term-2" }}
  headers={{ "X-TAXONOMY-ADAPTER": "local" }}
  description="Obtiene la ruta de navegaci√≥n (breadcrumb) de un t√©rmino. Ejemplo: 'Electronics/Smartphones' para term-2"
/>

---

## üîÑ Sistema de Adaptadores

Cada endpoint soporta cambio din√°mico de repositorio via header HTTP:

```bash
# Usar Eloquent (default - base de datos)
curl http://localhost:8000/v1/taxonomy/vocabularies/read

# Usar InMemory (datos pre-cargados para testing)
curl http://localhost:8000/v1/taxonomy/vocabularies/read \
  -H "X-TAXONOMY-ADAPTER: local"
```

### Adaptadores disponibles

| Header Value | Repositorio | Uso |
|--------------|-------------|-----|
| `eloquent` (default) | `TermRepository` / `VocabularyRepository` | Producci√≥n |
| `local` | `InMemoryTermRepository` / `InMemoryVocabularyRepository` | Testing, demos |

---

## üìê Arquitectura

### Generaci√≥n de IDs

Los IDs son generados en la capa de Infrastructure (Controller) usando `Thaumware\Support\Uuid\Uuid::v4()`:

```php
// TaxonomyController.php
public function createTerm(Request $request, CreateTerm $createTerm): JsonResponse
{
    $term = $createTerm->execute(
        Uuid::v4(),  // ID generado en Infrastructure
        $validated['name'],
        $validated['vocabulary_id'],
        $validated['description'] ?? null
    );
    // ...
}
```

### Convenciones de Naming

- **Domain/Application**: camelCase (`vocabularyId`, `fromTermId`)
- **Infrastructure (toArray)**: snake_case (`vocabulary_id`, `from_term_id`)

---

## Tipos de taxonom√≠a soportados

- **Vocabularios**: Contenedores de t√©rminos organizados por dominio (ej: "Product Categories", "Brands")
- **T√©rminos**: Elementos individuales dentro de un vocabulario con relaciones jer√°rquicas padre-hijo
- **Relaciones**: Conexiones entre t√©rminos (parent-child) para navegaci√≥n en √°rbol

## Notas

- Los vocabularios y t√©rminos se almacenan en tablas MySQL/PostgreSQL bajo el prefijo `taxonomy_`
- Cada endpoint tiene un selector integrado de adaptador que controla el header `X-TAXONOMY-ADAPTER`
- El adapter local incluye datos jer√°rquicos pre-cargados para testing y desarrollo
- Soporta navegaci√≥n jer√°rquica completa con trees y breadcrumbs
- Las relaciones padre-hijo se gestionan mediante el m√≥dulo TermRelation
