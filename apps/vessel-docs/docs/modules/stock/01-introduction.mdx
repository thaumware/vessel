---
sidebar_position: 1
---

# IntroducciÃ³n

Sistema de gestiÃ³n de inventario flexible y extensible con arquitectura hexagonal.

## CaracterÃ­sticas Principales

| CaracterÃ­stica | DescripciÃ³n |
|----------------|-------------|
| ğŸ·ï¸ **Items de Stock** | Existencia fÃ­sica vinculada opcionalmente a catÃ¡logos externos |
| ğŸ“ **ConfiguraciÃ³n de Ubicaciones** | Reglas de capacidad, restricciones y validaciones por ubicaciÃ³n |
| ğŸ“‹ **Movimientos Kardex** | Registro inmutable de todas las operaciones de inventario |
| ğŸ“¦ **Lotes** | Trazabilidad completa con identificadores y atributos flexibles |
| ğŸŒ³ **JerarquÃ­a de Ubicaciones** | CÃ¡lculo de stock considerando ubicaciÃ³n padre + hijos |
| ğŸ”Œ **Adaptadores Intercambiables** | InMemory para testing, Eloquent para producciÃ³n |

## Conceptos Clave

### Stock Item
Representa la **existencia fÃ­sica** de un producto en una ubicaciÃ³n especÃ­fica. Puede estar vinculado a un catÃ¡logo externo o funcionar de forma independiente.

### Movement (Movimiento)
Registro **inmutable** de cada operaciÃ³n de inventario. Los movimientos son la fuente de verdad del sistema - el stock se calcula agregando movimientos.

### Lot (Lote)
Grupo de unidades que comparten caracterÃ­sticas comunes (origen, fecha producciÃ³n, atributos de calidad). Soporta identificadores y atributos dinÃ¡micos.

### Location Settings
ConfiguraciÃ³n de restricciones de inventario para una ubicaciÃ³n: capacidad mÃ¡xima, tipos permitidos, mezcla de SKUs/lotes, FIFO, etc.

## Arquitectura

```
Stock/
â”œâ”€â”€ Domain/                    # NÃºcleo del negocio
â”‚   â”œâ”€â”€ Entities/             # StockItem, Movement, Lot, LocationStockSettings
â”‚   â”œâ”€â”€ ValueObjects/         # MovementType, MovementStatus, LotStatus
â”‚   â”œâ”€â”€ Services/             # StockMovementService, StockCapacityService
â”‚   â””â”€â”€ Interfaces/           # Contratos de repositorios y gateways
â”œâ”€â”€ Application/
â”‚   â””â”€â”€ UseCases/             # Casos de uso (CreateStockItem, AdjustStock, etc.)
â””â”€â”€ Infrastructure/
    â”œâ”€â”€ In/Http/              # Controllers, Routes, Requests
    â””â”€â”€ Out/                  # Repositorios, Gateways a otros mÃ³dulos
```

## Flujo de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Request   â”‚ â”€â”€â–¶ â”‚  UseCase    â”‚ â”€â”€â–¶ â”‚  Movement   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                   â”‚
                           â–¼                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Validate   â”‚     â”‚   Process   â”‚
                    â”‚  Capacity   â”‚     â”‚   & Save    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                       â”‚ StockItem   â”‚
                                       â”‚  Updated    â”‚
                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ejemplo: Bodega con Estantes

El sistema soporta stock en mÃºltiples niveles de jerarquÃ­a:

```
Bodega Principal (location_id: bodega-1)
â”œâ”€â”€ Stock directo: 50 unidades    â† Items "sueltos" en la bodega
â”œâ”€â”€ Estante A (location_id: estante-a)
â”‚   â””â”€â”€ Stock: 100 unidades
â”œâ”€â”€ Estante B (location_id: estante-b)
â”‚   â””â”€â”€ Stock: 75 unidades
â””â”€â”€ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    Total calculado: 225 unidades
```

Al consultar el stock de "Bodega Principal", el sistema suma automÃ¡ticamente el stock de la bodega + todos sus hijos.

## Cambio de Adaptador

Cambio dinÃ¡mico de repositorio via header HTTP:

```bash
# Eloquent (default - base de datos)
curl http://localhost/api/v1/stock/items

# InMemory (testing/demos)
curl http://localhost/api/v1/stock/items -H "X-STOCK-ADAPTER: local"
```

| Header Value | Repositorio | Uso |
|--------------|-------------|-----|
| `eloquent` | Base de datos | ProducciÃ³n |
| `local` | InMemory | Testing, demos |

## Testing

```bash
# Ejecutar tests del mÃ³dulo Stock
cd core
./vendor/bin/phpunit --testsuite Stock --testdox

# Tests especÃ­ficos
./vendor/bin/phpunit --filter StockMovementServiceTest
./vendor/bin/phpunit --filter MovementTest
```
